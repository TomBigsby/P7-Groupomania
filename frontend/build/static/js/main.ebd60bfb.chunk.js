(this.webpackJsonpgroupomania=this.webpackJsonpgroupomania||[]).push([[0],{47:function(e,t,s){},48:function(e,t,s){"use strict";s.r(t);var a=s(1),c=s.n(a),r=s(32),n=s.n(r),i=s(5),o=s(6),l=s(4),j=s(0),m=function(){return Object(j.jsxs)(j.Fragment,{children:[Object(j.jsx)("div",{className:"header bg-big",children:Object(j.jsx)("div",{className:"logo logo-big"})}),Object(j.jsx)("div",{className:"main-position bg-big"})]})},u="https://groupomania.thomak.xyz/backend",d=function(){var e=Object(a.useState)(!1),t=Object(i.a)(e,2),s=t[0],c=t[1],r=Object(a.useState)({email_error:"",password_error:""}),n=Object(i.a)(r,2),m=n[0],d=n[1],b=Object(l.useHistory)(),p=Object(a.useState)(!1),O=Object(i.a)(p,2),h=O[0],x=O[1],f=Object(a.useState)(!1),v=Object(i.a)(f,2),g=v[0],N=v[1],_=Object(a.useRef)(),w=Object(a.useRef)();return Object(j.jsxs)("div",{className:"login-container",children:[Object(j.jsx)("div",{className:"welcome",children:"Bienvenue"}),Object(j.jsx)("div",{className:"filet"}),Object(j.jsx)("div",{className:"connect",children:"Connectez-vous"}),Object(j.jsxs)("form",{className:"login-form",onSubmit:function(e){e.preventDefault(),""!==e.target.email.value&&""!==e.target.password.value?(d({email_error:"",password_error:""}),fetch("".concat(u,"/api/auth/login"),{method:"POST",body:JSON.stringify({email:_.current.value,password:w.current.value}),headers:{"Content-Type":"application/json"}}).then((function(e){return e.json().then((function(e){if(c(e),e.userId){N(!0);var t={userId:e.userId,username:e.username,avatarUrl:e.avatarUrl,isAdmin:e.isAdmin};localStorage.setItem("token",JSON.stringify(e.token)),localStorage.setItem("currentUserInfos",JSON.stringify(t)),x(!0)}}))}))):(""===e.target.email.value&&d({email_error:"Email manquant",password_error:""}),""===e.target.password.value&&d({email_error:"",password_error:"Mot de passe manquant"}),""===e.target.email.value&&""===e.target.password.value&&d({email_error:"Email manquant",password_error:"Mot de passe manquant"}))},children:[Object(j.jsxs)("div",{className:"field-bloc",children:[Object(j.jsxs)("label",{htmlFor:"email",children:["email ",Object(j.jsx)("span",{className:"red",children:"* "})]}),Object(j.jsx)("input",{type:"email",id:"email",name:"email",ref:_}),Object(j.jsxs)("div",{className:"error-msg",children:[m.email_error,s.error_login_user&&Object(j.jsx)("p",{children:s.error_login_user})]})]}),Object(j.jsxs)("div",{className:"field-bloc",children:[Object(j.jsxs)("label",{htmlFor:"password",children:["mot de passe ",Object(j.jsx)("span",{className:"red",children:"* "})]}),Object(j.jsx)("input",{type:"password",id:"password",ref:w}),Object(j.jsxs)("div",{className:"error-msg",children:[m.password_error,s.error_login_password&&Object(j.jsx)("p",{children:s.error_login_password})]})]}),Object(j.jsx)("input",{type:"submit",name:"Connexion",value:"Connexion",className:"bt",onClick:function(){h&&g&&s&&!s.error_login_user&&!s.error_login_password&&b.push("/publications")}}),Object(j.jsxs)("div",{className:"signup-link",children:["Vous n'avez pas de compte ? ",Object(j.jsx)(o.b,{exact:!0,to:"/inscription",children:"inscrivez-vous"})]}),Object(j.jsxs)("div",{className:"required-field",children:[Object(j.jsx)("span",{className:"red",children:"* "}),"Champs obligatoires"]})]})]})},b=function(){return Object(j.jsxs)(j.Fragment,{children:[Object(j.jsx)(m,{}),Object(j.jsx)("div",{className:"main",children:Object(j.jsx)(d,{})})]})},p=s.p+"static/media/avatar.6890d106.svg",O=function(){var e=Object(a.useState)(!1),t=Object(i.a)(e,2),s=t[0],c=t[1],r=Object(a.useState)({preview:"",imageUrl:""}),n=Object(i.a)(r,2),m=n[0],d=n[1],b=Object(a.useState)({email_error:"",password_error:"",username_error:""}),O=Object(i.a)(b,2),h=O[0],x=O[1],f=Object(a.useState)(!1),v=Object(i.a)(f,2),g=v[0],N=v[1],_=Object(a.useRef)(),w=Object(a.useRef)();return Object(j.jsxs)("div",{className:"login-container",children:[Object(j.jsx)("div",{className:"welcome",children:"Inscription"}),Object(j.jsx)("div",{className:"filet"}),Object(j.jsx)("div",{className:"connect",children:"Rejoignez-nous"}),Object(j.jsxs)("form",{className:"signup-form",onSubmit:function(e){e.preventDefault();var t=new FormData(e.target);t.append("adminChecked",w.current.checked),""!==e.target.email.value&&""!==e.target.password.value&&""!==e.target.username.value?(x({email_error:"",password_error:"",username_error:""}),fetch("".concat(u,"/api/auth/signup"),{method:"POST",body:t}).then((function(t){return t.json().then((function(t){c(t);var s={userId:t._id,token:t.token,username:e.target.username.value,avatarUrl:t.avatarUrl,isAdmin:t.isAdmin};localStorage.setItem("currentUserInfos",JSON.stringify(s)),localStorage.setItem("token",JSON.stringify(t.token)),N(!0)}))}))):(""===e.target.email.value&&x({email_error:"Email manquant",password_error:"",username_error:""}),""===e.target.password.value&&x({email_error:"",password_error:"Mot de passe manquant",username_error:""}),""===e.target.username.value&&x({email_error:"",password_error:"",username_error:"Nom d'utilisateur manquant"}),""===e.target.email.value&&""===e.target.password.value&&x({email_error:"Email manquant",password_error:"Mot de passe manquant",username_error:""}),""===e.target.email.value&&""===e.target.username.value&&x({email_error:"Email manquant",password_error:"",username_error:"Nom d'utilisateur manquant"}),""===e.target.password.value&&""===e.target.username.value&&x({password_error:"Mot de passe manquant",username_error:"Nom d'utilisateur manquant"}),""===e.target.email.value&&""===e.target.password.value&&""===e.target.username.value&&x({email_error:"Email manquant",password_error:"Mot de passe manquant",username_error:"Nom d'utilisateur manquant"}))},children:[Object(j.jsxs)("div",{className:"signup-avatar",children:[Object(j.jsx)("div",{className:"signup-avatar-text-hover",children:"Importer une image"}),Object(j.jsx)("label",{htmlFor:"upload-button",children:m.preview?Object(j.jsx)("img",{src:m.preview,alt:""}):Object(j.jsx)("img",{src:p,alt:""})}),Object(j.jsx)("input",{type:"file",name:"image",id:"upload-button",accept:".png, .jpg, .jpeg",onChange:function(e){e.target.files.length&&d({preview:URL.createObjectURL(e.target.files[0]),imageUrl:e.target.files[0]})},style:{display:"none"}})]}),Object(j.jsxs)("div",{className:"field-bloc",children:[Object(j.jsxs)("label",{htmlFor:"email",children:["Email ",Object(j.jsx)("span",{className:"red",children:"* "})]}),Object(j.jsx)("input",{type:"email",id:"email",name:"email"}),Object(j.jsxs)("div",{className:"error-msg",children:[h.email_error,s.error_signup_email&&Object(j.jsx)("p",{children:s.error_signup_email})||s.error_signup_email_exist&&Object(j.jsx)("p",{children:s.error_signup_email_exist})]}),s.error_signup_email_exist&&Object(j.jsxs)(o.b,{exact:!0,to:"/login",style:{fontSize:"0.8em",color:"white",textDecoration:"underline"},children:[" ",Object(j.jsx)("i",{className:"fas fa-long-arrow-alt-right"})," Page de connexion"]})]}),Object(j.jsxs)("div",{className:"field-bloc",children:[Object(j.jsxs)("label",{htmlFor:"password",children:["mot de passe ",Object(j.jsx)("span",{className:"red",children:"* "})," ",Object(j.jsx)("i",{className:"fas fa-info-circle"})," ",Object(j.jsx)("div",{className:"infobulle",children:"Doit contenir une majuscule, une minuscule, plus de 8 caract\xe8res et au moins 1 caract\xe8re sp\xe9cial parmi : ! @ # $ % ^ & *"})]}),Object(j.jsx)("input",{type:"password",id:"password",name:"password"}),Object(j.jsxs)("div",{className:"error-msg",children:[" ",h.password_error,s.error_signup_password&&Object(j.jsx)("p",{children:s.error_signup_password})]})]}),Object(j.jsxs)("div",{className:"field-bloc",children:[Object(j.jsxs)("label",{htmlFor:"username",children:["Nom d'utilisateur ",Object(j.jsx)("span",{className:"red",children:"* "})]}),Object(j.jsx)("input",{type:"text",id:"username",name:"username"}),Object(j.jsxs)("div",{className:"error-msg",children:[" ",h.username_error]})]}),Object(j.jsxs)("div",{className:"adminConnexion",children:[Object(j.jsx)("input",{className:"checkbox",type:"checkbox",id:"admin",ref:w,onClick:function(){w.current.checked,_.current.classList.toggle("invisible")}}),Object(j.jsx)("label",{htmlFor:"admin",children:"Compte administrateur"}),Object(j.jsx)("input",{type:"password",className:"adminPassword invisible",name:"adminPassword",placeholder:"Code admin",ref:_}),Object(j.jsxs)("div",{className:"error-msg",children:[" ",s.error_psw_admin&&Object(j.jsx)("p",{children:s.error_psw_admin})]})]}),Object(j.jsx)("input",{type:"submit",name:"Inscription",value:"Inscription",className:"bt"}),g&&s&&!s.error&&!s.error_signup_email&&!s.error_signup_email_exist&&!s.error_signup_password&&!s.error_psw_admin&&Object(j.jsx)(l.Redirect,{to:"/publications"}),Object(j.jsxs)("div",{className:"required-field",children:[Object(j.jsx)("span",{className:"red",children:"* "}),"Champs obligatoires"]})]})]})},h=function(){return Object(j.jsxs)(j.Fragment,{children:[Object(j.jsx)(m,{}),Object(j.jsx)("div",{className:"main",children:Object(j.jsx)(O,{})})]})},x=function(){var e=Object(a.useState)(""),t=Object(i.a)(e,2),s=t[0],c=t[1],r=JSON.parse(localStorage.getItem("currentUserInfos")),n="undefined"===r.avatarUrl?p:r.avatarUrl;return function(){var e=setTimeout((function(){"undefined"!==r.avatarUrl&&c(r.avatarUrl)}),100)}(),Object(j.jsxs)(j.Fragment,{children:[Object(j.jsxs)("div",{className:"header bg-small",children:[Object(j.jsx)("div",{className:"logo logo-small"}),Object(j.jsx)(o.b,{className:"bg-avatar",exact:!0,to:"/profil",children:Object(j.jsx)("img",{src:s||n,alt:""})})]}),Object(j.jsx)("div",{className:"main-position bg-small"})]})},f=s(34),v=function(e){var t=e.setIsLoggedIn,s=Object(f.useHistory)(),c=Object(a.useRef)(),r=Object(a.useRef)(),n=Object(a.useRef)(),i=Object(a.useRef)(),l=JSON.parse(localStorage.getItem("currentUserInfos")),m=l.username;return Object(j.jsxs)("div",{className:"container",children:[Object(j.jsx)("div",{className:"bt-close",children:Object(j.jsx)("i",{className:"fas fa-times"})}),Object(j.jsx)(o.b,{exact:!0,to:"/publications",className:"bt-close",children:Object(j.jsx)("i",{className:"fas fa-times"})}),Object(j.jsx)("div",{className:"avatar-profile",children:Object(j.jsx)("img",{src:"undefined"===l.avatarUrl?p:l.avatarUrl,alt:""})}),Object(j.jsx)("div",{className:"blocDisplay",ref:n,children:Object(j.jsx)("div",{className:"divRow",children:Object(j.jsxs)("div",{className:"username",ref:c,children:[m," "]})})}),Object(j.jsx)("div",{className:"bloc-edit invisible",ref:i,children:Object(j.jsx)("div",{className:"divRow",children:Object(j.jsx)("input",{className:"edit-field",type:"text",defaultValue:m,ref:r})})}),Object(j.jsx)("div",{className:"separatorH"}),Object(j.jsxs)("div",{className:"signout-delete-account",children:[Object(j.jsx)("div",{className:"bt-signout-account",children:Object(j.jsx)("i",{className:"fas fa-sign-out-alt",onClick:function(){localStorage.removeItem("token"),localStorage.removeItem("currentUserInfos"),t(!1),s.push("/login")}})}),Object(j.jsx)(o.b,{exact:!0,to:"/supression-profil",className:"bt-delete-account",children:Object(j.jsx)("i",{className:"far fa-trash-alt"})})]})]})},g=function(e){var t=e.setIsLoggedIn;return Object(j.jsxs)(j.Fragment,{children:[Object(j.jsx)(x,{}),Object(j.jsx)("div",{className:"main",children:Object(j.jsx)(v,{setIsLoggedIn:t})})]})},N=function(){var e=Object(a.useState)(!1),t=Object(i.a)(e,2),s=t[0],c=t[1],r=Object(a.useState)(!1),n=Object(i.a)(r,2),l=n[0],m=n[1],d=Object(a.useRef)(),b=Object(a.useRef)(),p=JSON.parse(localStorage.getItem("currentUserInfos"));return Object(j.jsx)(j.Fragment,{children:s?Object(j.jsx)("div",{ref:b,children:Object(j.jsxs)("div",{className:"container",children:[Object(j.jsx)("div",{className:"cry-pic"}),Object(j.jsx)("div",{className:"msg-quit",children:"Votre profil a \xe9t\xe9 supprim\xe9"}),Object(j.jsx)("div",{className:"choices",children:!0===l&&Object(j.jsx)(o.b,{exact:!0,to:"/login",children:Object(j.jsx)("button",{className:"bt",children:"Retour \xe0 l'accueil"})})})]})}):Object(j.jsx)("div",{ref:d,children:Object(j.jsxs)("div",{className:"container",children:[Object(j.jsx)("div",{className:"sad-pic"}),Object(j.jsx)("div",{className:"msg-quit",children:"Vous nous quittez ?"}),Object(j.jsx)("div",{className:"picto-warning"}),Object(j.jsxs)("div",{className:"text",children:[Object(j.jsx)("span",{children:Object(j.jsx)("strong",{children:"Confirmez-vous la suppression du compte ?"})}),Object(j.jsx)("br",{}),Object(j.jsx)("span",{children:"Cette action est irr\xe9versible."})]}),Object(j.jsxs)("div",{className:"choices",children:[Object(j.jsx)(o.b,{exact:!0,to:"/profil",children:Object(j.jsx)("button",{className:"bt-cancel",children:"Non, je reste"})}),Object(j.jsx)("button",{className:"bt bt-quit",onClick:function(){fetch("".concat(u,"/api/auth/delete/")+p.userId,{method:"DELETE"}).catch((function(e){return console.error(e)})).then((function(e){200===e.status&&(m(!0),c(!s))}))},children:"Oui, je supprime"})]})]})})})},_=function(){return Object(j.jsxs)(j.Fragment,{children:[Object(j.jsx)(x,{}),Object(j.jsx)("div",{className:"main",children:Object(j.jsx)(N,{})})]})},w=s(35),S=s(18),I=s(50),y=s(49),U=s(31).zonedTimeToUtc,k=JSON.parse(localStorage.getItem("token")),R=function(e){var t,s=Object(a.useState)(!1),c=Object(i.a)(s,2),r=c[0],n=c[1],o=Object(a.useState)(e.comment.commentAuthorMessage),l=Object(i.a)(o,2),m=l[0],d=l[1],b=Object(a.useRef)(),O=Object(a.useRef)(),h=Object(a.useRef)(),x=JSON.parse(localStorage.getItem("currentUserInfos")),f=function(e){if(n(!r),!0===r){!function(e,t){var s=new FormData;s.append("commentId",e),s.append("commentAuthorMessage",t),fetch("".concat(u,"/api/publications/comments/")+e,{method:"PUT",body:s,headers:{authorization:"Bearer "+k}}).then((function(e){return e.json()})).catch((function(e){return console.error(e)}))}(e,b.current.value),O.current.classList.replace("isEditMode","post-comment-picto");var t=b.current.value;d(t)}else b.current.disabled=!1,b.current.focus(),b.current.select(),O.current.classList.replace("post-comment-picto","isEditMode")},v=function(e){var t=b.current.value;d(t),n(!1),f(e)};return Object(j.jsx)(j.Fragment,{children:Object(j.jsxs)("div",{className:"post-comment",children:[Object(j.jsxs)("div",{className:"comment-cache invisible",ref:h,children:[Object(j.jsx)("div",{className:"comment-cache-background"}),Object(j.jsxs)("div",{className:"comment-cache-deleteMsg",children:[Object(j.jsx)("p",{children:"Confirmez-vous la suppression de ce commentaire ?"}),Object(j.jsxs)("div",{className:"buttons",children:[Object(j.jsx)("button",{className:"bt-cancel",onClick:function(){h.current.classList.add("invisible")},children:"Non"}),Object(j.jsx)("button",{className:"bt",onClick:function(){h.current.classList.add("invisible"),e.commentToDelete(e.comment._id)},children:"Oui, je supprime"})]})]})]}),Object(j.jsxs)("div",{className:"post-comment-bloc1",children:[Object(j.jsx)("div",{className:"post-comment-bloc1-a",children:Object(j.jsx)("div",{className:"post-comment-avatar",children:Object(j.jsx)("img",{src:"undefined"===e.comment.commentAuthorAvatarUrl?p:e.comment.commentAuthorAvatarUrl,alt:""})})}),Object(j.jsxs)("div",{className:"post-comment-bloc1-b",children:[Object(j.jsx)("div",{className:"post-comment-name",children:e.comment.commentAuthorUserName}),Object(j.jsxs)("div",{className:"post-comment-date",children:["\xa0\xa0",Object(j.jsx)("span",{children:"\xa0"}),"il y a ",(t=e.comment.commentDate,Object(y.a)(U(t),{locale:I.a,includeSeconds:!1}))]}),(x.isAdmin||x.userId===e.comment.commentAuthorId)&&Object(j.jsxs)("div",{className:"post-comment-pictos",children:[Object(j.jsx)("div",{className:"post-comment-picto-edit",ref:O,onClick:function(){f(e.comment._id)},children:r?Object(j.jsx)("div",{children:Object(j.jsx)("i",{className:"fas fa-undo-alt"})}):Object(j.jsx)("div",{children:Object(j.jsx)("i",{className:"fas fa-edit"})})}),Object(j.jsx)("div",{className:"post-comment-picto-delete",onClick:function(){h.current.classList.remove("invisible")},children:Object(j.jsx)("i",{className:"far fa-trash-alt"})})]})]})]}),Object(j.jsx)("div",{className:"post-comment-bloc2",children:r?Object(j.jsxs)("div",{className:"group",children:[Object(j.jsx)(S.a,{className:"post-comment-message textareaAutosize highlight",onKeyDown:function(t){!function(e,t){"Enter"===e.key&&v(t)}(t,e.comment._id)},ref:b,defaultValue:m}),Object(j.jsx)("div",{className:"bt-valid-comment",onClick:function(){var t;t=e.comment._id,v(t)},children:Object(j.jsx)("i",{className:"fas fa-check-square"})})]}):Object(j.jsx)(S.a,{className:"post-comment-message textareaAutosize",disabled:!0,ref:b,value:m})})]})})},C=s(23),T=s(31).zonedTimeToUtc,E=function(e){var t=Object(a.useState)([]),s=Object(i.a)(t,2),c=s[0],r=s[1],n=Object(a.useState)(!1),o=Object(i.a)(n,2),l=o[0],m=o[1],d=Object(a.useState)(!1),b=Object(i.a)(d,2),O=b[0],h=b[1],x=Object(a.useState)(e.publication.postTitle),f=Object(i.a)(x,2),v=f[0],g=f[1],N=Object(a.useState)({preview:e.publication.imageUrl,imageUrl:""}),_=Object(i.a)(N,2),U=_[0],k=_[1],E=Object(a.useState)(0),q=Object(i.a)(E,2),D=q[0],F=q[1],L=Object(a.useRef)(),z=Object(a.useRef)(),A=Object(a.useRef)(),M=Object(a.useRef)(),J=Object(a.useRef)(),B=JSON.parse(localStorage.getItem("currentUserInfos")),P=JSON.parse(localStorage.getItem("token")),V=function(){h(!O),!0===O?L.current.classList.toggle("post-author-edit"):(L.current.classList.toggle("post-author-edit"),z.current.disabled=!1,z.current.focus(),z.current.select())};Object(a.useEffect)((function(){fetch("".concat(u,"/api/publications/' + props.publication._id + '/comments"),{method:"GET",headers:{authorization:"Bearer "+P}}).then((function(e){return e.json()})).then((function(t){r(t),F(t.filter((function(t){return t.postId===e.publication._id})).length)})).catch((function(e){return console.error(e)}))}),[e.publication._id,P]);var H,G=function(e){if(""!==M.current.value){var t=new FormData;t.append("commentAuthorId",B.userId),t.append("commentAuthorUserName",B.username),t.append("commentAuthorAvatarUrl",B.avatarUrl),t.append("commentDate",$),t.append("commentAuthorMessage",M.current.value),M.current.value="",fetch("".concat(u,"/api/publications/")+e+"/comments",{method:"POST",body:t,headers:{authorization:"Bearer "+P}}).then((function(e){if(e.ok)return e.json();throw new Error("Une erreur est survenue lors de l'ajout du commentaire.")})).then((function(e){r([].concat(Object(w.a)(c),[e])),F(D+1),m(!0)})).catch((function(e){return console.error(e)}))}else M.current.classList.add("warning-field"),M.current.blur()},K=function(e){fetch("".concat(u,"/api/publications/comments/")+e,{method:"DELETE",headers:{authorization:"Bearer "+P}}).then((function(t){if(!t.ok)throw new Error("Une erreur est survenue lors de la suppression du commentaire.");r(c.filter((function(t){return t._id!==e}))),F(D-1)})).catch((function(e){return console.error(e)}))},$=Object(C.a)(new Date,"yyyy-MM-dd'T'HH:mm:ss");return Object(j.jsxs)(j.Fragment,{children:[Object(j.jsxs)("div",{className:"post-cache invisible",ref:J,children:[Object(j.jsx)("div",{className:"post-cache-background"}),Object(j.jsxs)("div",{className:"post-cache-deleteMsg",children:[Object(j.jsx)("p",{children:"Confirmez-vous la suppression du message ainsi que tous ses commentaires ?"}),Object(j.jsxs)("div",{className:"buttons",children:[Object(j.jsx)("button",{className:"bt-cancel",onClick:function(){J.current.classList.add("invisible")},children:"Non"}),Object(j.jsx)("button",{className:"bt",onClick:function(){J.current.classList.add("invisible"),e.postToDelete(e.publication._id)},children:"Oui, je supprime"})]})]})]}),Object(j.jsxs)("div",{className:"post-author",ref:L,children:[Object(j.jsx)("div",{className:"post-author-avatar",children:Object(j.jsx)("img",{src:"undefined"===e.publication.avatarUrl?p:e.publication.avatarUrl,alt:""})}),Object(j.jsx)("div",{children:Object(j.jsxs)("span",{className:"post-author-name",children:[e.publication.username," ",Object(j.jsx)("span",{children:"\xa0"}),Object(j.jsxs)("span",{className:"post-author-date",children:["il y a ",(H=e.publication.postDate,Object(y.a)(T(H),{locale:I.a,includeSeconds:!1}))]})]})}),(B.isAdmin||B.userId===e.publication.userId)&&Object(j.jsxs)("div",{className:"post-author-pictos",children:[Object(j.jsx)("div",{className:"post-author-picto-edit",ref:A,onClick:function(){return V()},children:O?Object(j.jsx)("div",{children:Object(j.jsx)("i",{className:"fas fa-undo-alt"})}):Object(j.jsx)("div",{children:Object(j.jsx)("i",{className:"fas fa-edit"})})}),Object(j.jsx)("div",{className:"post-author-picto-delete",onClick:function(){J.current.classList.remove("invisible"),m(!1)},children:Object(j.jsx)("i",{className:"fas fa-trash-alt"})})]})]}),O?Object(j.jsxs)("form",{className:"post-publication box",onSubmit:function(t){return function(e,t){e.preventDefault(),V();var s=new FormData(e.target);s.append("postId",t),g(e.target.postTitle.value),fetch("".concat(u,"/api/publications/")+t,{method:"PUT",body:s,headers:{authorization:"Bearer "+P}}).then((function(e){return e.json()})).catch((function(e){return console.error(e)}))}(t,e.publication._id)},children:[Object(j.jsx)(S.a,{className:"post-publication-title textareaAutosize highlights",name:"postTitle",id:"titre",ref:z,defaultValue:v}),Object(j.jsx)("label",{htmlFor:"upload-button",children:Object(j.jsxs)("div",{children:[Object(j.jsxs)("div",{className:"upload-button",children:[Object(j.jsx)("i",{className:"fas fa-file-upload"})," \xa0Charger une nouvelle image"]}),Object(j.jsx)("div",{className:"post-publication-image",children:Object(j.jsx)("img",{src:U.preview,alt:""})})]})}),Object(j.jsx)("input",{type:"file",name:"image",id:"upload-button",accept:".png, .jpg, .jpeg",onChange:function(e){e.target.files.length&&k({preview:URL.createObjectURL(e.target.files[0]),imageUrl:e.target.files[0]})},style:{display:"none"}}),Object(j.jsx)("input",{type:"submit",name:"envoyer-message",value:"Valider la modification",className:"bt"})]}):Object(j.jsxs)("div",{className:"post-publication box",children:[Object(j.jsx)(S.a,{className:"post-publication-title textareaAutosize",disabled:!0,ref:z,value:v}),Object(j.jsx)("div",{className:"post-publication-image",children:Object(j.jsx)("img",{src:U.preview,alt:""})})]}),Object(j.jsxs)("form",{form:"true",className:"post-new-comment box",onSubmit:function(t){t.preventDefault(),G(e.publication._id),M.current.blur()},children:[Object(j.jsx)("div",{className:"post-new-comment-avatar",children:Object(j.jsx)("img",{src:void 0===B.avatarUrl?p:B.avatarUrl,alt:""})}),Object(j.jsx)("input",{type:"text",className:"post-new-comment-message",ref:M,placeholder:"Ecrire un commentaire",onChange:function(e){e.target.classList.remove("warning-field")},onKeyDown:function(t){"Enter"===t.key&&G(e.publication._id)},onBlur:function(){""===M.current.value&&M.current.classList.remove("warning-field")}}),Object(j.jsx)("div",{className:"post-new-comment-send",onClick:function(){return G(e.publication._id)},children:Object(j.jsx)("i",{className:"fas fa-arrow-circle-right"})})]}),Object(j.jsxs)("div",{className:"post-interactions box",children:[Object(j.jsx)("div",{className:"separatorV"}),Object(j.jsxs)("div",{className:"post-interactions-comments",children:[Object(j.jsx)("div",{className:"post-interactions-comments-picto",children:Object(j.jsx)("i",{className:"far fa-comment "})}),Object(j.jsxs)("div",{className:"post-interactions-comments-number",children:[D<2?D+" commentaire":D+" commentaires"," "]}),D>0&&Object(j.jsx)("div",{onClick:function(){return m(!l)},children:l?Object(j.jsx)(j.Fragment,{children:Object(j.jsx)("i",{className:"fas fa-caret-square-up",title:"Masquer les commentaires"})}):Object(j.jsx)("i",{className:"fas fa-caret-square-down",title:"Afficher les commentaires"})})]})]}),l&&c.filter((function(t){return t.postId===e.publication._id})).sort((function(e,t){return new Date(t.commentDate)-new Date(e.commentDate)})).map((function(t){return Object(j.jsx)("div",{children:t.postId===e.publication._id&&Object(j.jsx)("div",{className:"post-comments box",children:Object(j.jsx)(R,{comment:t,commentPostId:t.postId,commentToDelete:K})})},t._id)})),Object(j.jsx)("div",{className:l?"close-comments":"close-comments hidden",title:"Fermer le volet des commentaires",onClick:function(){return m(!l)},children:Object(j.jsx)("i",{className:"fas fa-caret-up",title:"Masquer les commentaires"})})]})},q=function(){var e=Object(a.useState)([]),t=Object(i.a)(e,2),s=t[0],c=t[1],r=JSON.parse(localStorage.getItem("token"));Object(a.useEffect)((function(){fetch("".concat(u,"/api/publications"),{method:"GET",headers:{"Content-Type":"multipart/form-data",authorization:"Bearer "+r}}).then((function(e){return e.json()})).then((function(e){return c(e)})).catch((function(e){return console.error(e)}))}),[r]);var n=function(e){fetch("".concat(u,"/api/publications/")+e,{method:"DELETE",headers:{authorization:"Bearer "+r}}).then((function(e){if(e.ok)return fetch("".concat(u,"/api/publications"),{method:"GET",headers:{authorization:"Bearer "+r}});throw new Error("Erreur lors de la suppression de la publication")})).then((function(e){return e.json()})).then((function(e){return c(e)})).catch((function(e){return console.error(e)}))};return Object(j.jsx)(j.Fragment,{children:s&&s.map((function(e){return Object(j.jsx)("div",{className:"post-container",children:Object(j.jsx)(E,{publication:e,postToDelete:n})},e._id)}))})},D=function(){return Object(j.jsxs)(j.Fragment,{children:[Object(j.jsx)(x,{}),Object(j.jsxs)("div",{className:"main",children:[Object(j.jsx)("div",{className:"intro",children:"Les derni\xe8res publications"}),Object(j.jsx)(q,{}),Object(j.jsx)(o.b,{exact:!0,to:"/nouvelle-publication",className:"bt-new-publication",children:Object(j.jsx)("i",{className:"fas fa-edit"})})]})]})},F=function(){var e=Object(a.useState)({preview:"",imageUrl:""}),t=Object(i.a)(e,2),s=t[0],c=t[1],r=Object(a.useState)(!1),n=Object(i.a)(r,2),m=n[0],d=n[1],b=Object(a.useState)({title_error:"",image__error:""}),O=Object(i.a)(b,2),h=O[0],x=O[1],f=JSON.parse(localStorage.getItem("currentUserInfos")),v=JSON.parse(localStorage.getItem("token"));return Object(j.jsx)(j.Fragment,{children:Object(j.jsxs)("div",{className:"post-container new-post-container",children:[Object(j.jsxs)("div",{className:"post-author",children:[Object(j.jsx)("div",{className:"post-author-avatar",children:Object(j.jsx)("img",{src:"undefined"===f.avatarUrl?p:f.avatarUrl,alt:""})}),Object(j.jsx)("div",{children:Object(j.jsx)("span",{className:"post-author-name",children:f.username})}),Object(j.jsx)(o.b,{exact:!0,to:"/publications",className:"bt-close",children:Object(j.jsx)("i",{className:"fas fa-times"})})]}),Object(j.jsxs)("form",{className:"post-new-publication",onSubmit:function(e){e.preventDefault();var t=Object(C.a)(new Date,"yyyy-MM-dd'T'HH:mm:ss"),s=new FormData(e.target);s.append("postDate",t),s.append("username",f.username),s.append("avatarUrl",f.avatarUrl),s.append("userId",f.userId),""!==e.target.postTitle.value&&void 0!==e.target.image.files[0]?fetch("".concat(u,"/api/publications"),{method:"POST",body:s,headers:{authorization:"Bearer "+v}}).then((function(e){return e.json().then((function(e){d(e)}))})):(""===e.target.postTitle.value&&x({title_error:"Titre manquant",image_error:""}),void 0===e.target.image.files[0]&&x({title_error:"",image_error:"Image manquante"}),""===e.target.postTitle.value&&void 0===e.target.image.files[0]&&x({title_error:"Titre manquant",image_error:"Image manquante"}))},children:[Object(j.jsx)("input",{type:"text",name:"postTitle",id:"titre",placeholder:"Titre de la publication"}),Object(j.jsxs)("div",{className:"error-msg",children:[" ",Object(j.jsx)("p",{children:h.title_error})]}),Object(j.jsx)("label",{htmlFor:"upload-button",children:s.preview?Object(j.jsx)("img",{src:s.preview,alt:""}):Object(j.jsxs)("div",{className:"upload-button",children:[Object(j.jsx)("i",{className:"fas fa-file-upload"})," \xa0Charger une image"]})}),Object(j.jsx)("input",{type:"file",name:"image",id:"upload-button",accept:".png, .jpg, .jpeg",onChange:function(e){e.target.files.length&&c({preview:URL.createObjectURL(e.target.files[0]),imageUrl:e.target.files[0]})},style:{display:"none"}}),Object(j.jsxs)("div",{className:"error-msg",children:[" ",Object(j.jsx)("p",{children:h.image_error})]}),Object(j.jsx)("input",{type:"submit",name:"envoyer-message",value:"Envoyer la publication",className:"bt"}),void 0!==m.message&&Object(j.jsx)(l.Redirect,{to:"/publications"})]})]})})},L=function(){return Object(j.jsxs)(j.Fragment,{children:[Object(j.jsx)(x,{}),Object(j.jsx)("div",{className:"main",children:Object(j.jsx)(F,{})})]})},z=function(){return Object(j.jsxs)(j.Fragment,{children:[Object(j.jsx)(m,{}),Object(j.jsx)("div",{className:"main",children:Object(j.jsxs)("div",{className:"page404",children:[Object(j.jsx)("h1",{children:"Erreur 404"}),Object(j.jsx)("div",{className:"message404",children:"page non trouv\xe9e"}),Object(j.jsx)(o.b,{exact:!0,to:"/",children:"Retour \xe0 l'accueil"})]})})]})};var A=function(){var e=Object(a.useState)(!!localStorage.getItem("token")),t=Object(i.a)(e,2),s=t[0],c=t[1];return Object(a.useEffect)((function(){var e=localStorage.getItem("token");c(!!e);var t=setInterval((function(){var e=localStorage.getItem("token");c(!!e)}),1e3);return function(){return clearInterval(t)}}),[]),Object(j.jsx)("div",{className:"App",children:Object(j.jsx)(o.a,{children:Object(j.jsxs)(l.Switch,{children:[s&&Object(j.jsx)(l.Redirect,{exact:!0,from:"/login",to:"/publications"}),!s&&Object(j.jsx)(l.Redirect,{exact:!0,from:"/",to:"/login"}),Object(j.jsx)(l.Route,{path:"/page404",exact:!0,component:z}),s?Object(j.jsxs)(j.Fragment,{children:[Object(j.jsx)(l.Route,{path:"/login",children:Object(j.jsx)(l.Redirect,{to:"/publications"})}),Object(j.jsx)(l.Route,{exact:!0,path:"/",children:Object(j.jsx)(l.Redirect,{to:"/publications"})}),Object(j.jsx)(l.Route,{path:"/profil",exact:!0,children:Object(j.jsx)(g,{setIsLoggedIn:c})}),Object(j.jsx)(l.Route,{path:"/publications",exact:!0,component:D}),Object(j.jsx)(l.Route,{path:"/suppression-profil",exact:!0,component:_}),Object(j.jsx)(l.Route,{path:"/nouvelle-publication",exact:!0,component:L})]}):Object(j.jsxs)(j.Fragment,{children:[Object(j.jsx)(l.Route,{exact:!0,path:"/",children:Object(j.jsx)(l.Redirect,{to:"/login"})}),Object(j.jsx)(l.Route,{path:"/login",exact:!0,component:b}),Object(j.jsx)(l.Route,{path:"/inscription",exact:!0,component:h}),Object(j.jsx)(l.Redirect,{to:"/login"})]}),Object(j.jsx)(l.Route,{path:"*",component:z})]})})})};s(47);n.a.render(Object(j.jsx)(c.a.StrictMode,{children:Object(j.jsx)(A,{})}),document.getElementById("root"))}},[[48,1,2]]]);
//# sourceMappingURL=main.ebd60bfb.chunk.js.map